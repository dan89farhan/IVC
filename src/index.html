<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../src/assets/bootstrap-4.5.3-dist/css/bootstrap.min.css">

    <!-- Insert this line above script imports  -->
    <script>
        if (typeof module === 'object') { window.module = module; module = undefined; }
    </script>

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="../src/assets/lib/jquery-3.5.1.slim.min.js"></script>
    <script src="../src/assets/bootstrap-4.5.3-dist/js/bootstrap.bundle.min.js"></script>
    <script src="../src/assets/lib/jquery.validate.min.js"></script>

    <!-- Custom Js -->
    <script src="app.js"></script>


    <title>IVC</title>

    <style>
        #notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 200px;
            padding: 20px;
            border-radius: 5px;
            background-color: white;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-sm">
                <div id="carouselExampleSlidesOnly" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="./assets/img/india-flag.jpg" class="d-block w-100" style="height: 200px;"
                                alt="India Flag">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <form id="convertVideoForm" method="POST" enctype="multipart/form-data">
            <div class="row">
                <div class="col-sm">
                    <div class="form-group">
                        <label for="Select File">Select Input File</label>
                        <input type="file" name="inputFile" class="form-control-file" id="Select File">
                    </div>
                </div>

                <div class="col-sm radiocls">
                    <label for="">Select Format</label>
                    <br />
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="encode" value="hls" id="hls" checked>
                        <label class="form-check-label" for="hls">
                            HLS
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="encode" value="dash" id="dash">
                        <label class="form-check-label" for="dash">
                            DASH
                        </label>
                    </div>
                </div>
                <div class="col-sm radiocls">
                    <label for="">Select Bit Rate Min</label>
                    <br />
                    <div class="d-flex justify-content-center my-4">
                        <div class="range-field w-75">
                            <input name="bitratemin" id="bitratemin" class="border-0" type="range" min="0" max="200" />
                        </div>
                        <span class="font-weight-bold text-primary ml-2 mt-1 bitrateminSpan"></span>
                    </div>
                </div>

                <div class="col-sm radiocls">
                    <label for="">Select Bit Rate Max</label>
                    <br />
                    <div class="d-flex justify-content-center my-4">
                        <div class="range-field w-75">
                            <input name="bitratemax" id="bitratemax" class="border-0" type="range" min="0" max="200" />
                        </div>
                        <span class="font-weight-bold text-primary ml-2 mt-1 bitratemaxSpan"></span>
                    </div>
                </div>

                <div class="col-sm radiocls">
                    <label for="">Select Bit Rate Buffer</label>
                    <br />
                    <div class="d-flex justify-content-center my-4">
                        <div class="range-field w-75">
                            <input name="bitratebuffer" id="bitratebuffer" class="border-0" type="range" min="0" max="200" />
                        </div>
                        <span class="font-weight-bold text-primary ml-2 mt-1 bitratebufferSpan"></span>
                    </div>
                </div>

                <div class="col-sm radiocls">
                    <label for="">Select Resolution</label>
                    <br />
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="resolution" value="0" id="defaultCheck360">
                        <label class="form-check-label" for="defaultCheck360">
                            360
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="resolution" value="1" id="defaultCheck1">
                        <label class="form-check-label" for="defaultCheck">
                            640
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="resolution" value="2" id="defaultCheck720">
                        <label class="form-check-label" for="defaultCheck720">
                            720
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="resolution" value="3" id="defaultCheck1080">
                        <label class="form-check-label" for="defaultCheck">
                            1080
                        </label>
                    </div>
                </div>
                <div class="col-sm radiocls">
                    <label for="">Select Bitrate</label>
                    <br />
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="bitrate" value="0" id="defaultCheck360">
                        <label class="form-check-label" for="defaultCheck360">
                            5000
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="bitrate" value="1" id="defaultCheck1">
                        <label class="form-check-label" for="defaultCheck">
                            2800
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="bitrate" value="2" id="defaultCheck720">
                        <label class="form-check-label" for="defaultCheck720">
                            1400
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="bitrate" value="3" id="defaultCheck1080">
                        <label class="form-check-label" for="defaultCheck">
                            800
                        </label>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm">
                    <div class="form-group">
                        <label for="outputFileName">Output file name</label>
                        <input type="text" name="outputFileName" class="form-control" id="outputFileName"
                            aria-describedby="outputFileHelp">
                    </div>
                </div>
            </div>

            <div class="row">

                <div class="col-sm">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </div>
        </form>

        <div class="row">
            <div class="col-sm">
                <div class="form-group">
                    <label for="outputLogFile">Output Log file</label>
                    <textarea name="outputLogFile" class="form-control" id="outputLogFile"
                        aria-describedby="outputLogFile" rows="5" disabled></textarea>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                <button type="button" onclick="clearLogs()" class="btn btn-primary">Clear Logs</button>
            </div>
        </div>
    </div>

    <div id="notification" class="hidden">
        <p id="message"></p>
        <button id="close-button" onClick="closeNotification()">
            Close
        </button>
        <button id="restart-button" onClick="restartApp()" class="hidden">
            Restart
        </button>
    </div>

</body>


<script>
    $(`#convertVideoForm`).validate({
        errorClass: "text-danger",
        rules: {
            outputFileName: {
                required: true
            },
            inputFile: {
                required: true
            },
            resolution: {
                required: true
            },
            bitrate: {
                required: true
            },
        },
        messages: {
            outputFileName: {
                required: "*Output File is required"
            },
            inputFile: {
                required: "*Input File is required"
            },
            resolution: {
                required: "*Resolution is required"
            },
            bitrate: {
                required: "*Bit rate is required"
            },
        },
        errorPlacement: function (error, element) {
            if (element.is(":radio")) {
                error.appendTo(element.parents('.radiocls'));
            }
            else { // This is the default behavior 
                error.insertAfter(element);
            }
        },
        submitHandler: function (form) {
            let formData = new FormData(document.querySelector('form'));
            let formDataObj = {};
            for (var pair of formData.entries()) {
                formDataObj[pair[0]] = pair[1];
            }
            // console.log(formDataObj);
            convertVideo(formDataObj);
            return;
        }
    });

    $(document).ready(function () {

        const $valueSpan = $('.valueSpan');
        const $value = $('#slider11');
        $valueSpan.html($value.val());
        $value.on('input change', () => {

            $valueSpan.html($value.val());
        });

        const $bitrateminSpan = $('.bitrateminSpan');
        const $bitratemin = $('#bitratemin');
        $bitrateminSpan.html($bitratemin.val());
        $bitratemin.on('input change', () => {
            $bitrateminSpan.html($bitratemin.val());
        });

        const $bitratemanSpan = $('.bitratemaxSpan');
        const $bitratemax = $('#bitratemax');
        $bitratemanSpan.html($bitratemax.val());
        $bitratemax.on('input change', () => {
            $bitratemanSpan.html($bitratemax.val());
        });

        const $bitratebufferSpan = $('.bitratebufferSpan');
        const $bitratebuffer = $('#bitratebuffer');
        $bitratebufferSpan.html($bitratebuffer.val());
        $bitratebuffer.on('input change', () => {
            $bitratebufferSpan.html($bitratebuffer.val());
        });
    });
</script>

<!-- Insert this line after script imports -->
<script>
    if (window.module) module = window.module;
</script>

</html>